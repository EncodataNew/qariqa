<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <t t-name="wallbox_dashboard.DashboardTemplate">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
        <div class="d-flex flex-column h-100 wallbox_dashboard">
            <!-- Header -->
            <div class="d-sm-flex align-items-center justify-content-between mb-0 p-3 bg-white shadow-sm sticky-top">
                <h1 class="h3 mb-0 text-gray-800">Wallbox Dashboard</h1>
                <div class="btn-group">
                    <button class="btn btn-primary" t-on-click="() => this.loadData()">
                        <i class="fa fa-sync-alt" t-att-class="{'fa-spin': state.loading}"/> 
                        <span t-esc="state.loading ? 'Loading...' : ' Refresh'"/>
                    </button>
                </div>
            </div>

            <!-- Main Content Area with Scroll -->
            <div class="flex-grow-1 overflow-auto p-4 pt-0">
                <!-- Loading State -->
                <t t-if="state.loading and !state.chartLoaded">
                    <div class="text-center py-5">
                        <i class="fa fa-spinner fa-spin fa-3x"/> 
                        <p class="mt-3">Loading dashboard data...</p>
                    </div>
                </t>

                <!-- Content -->
                <t t-else="">
                    <!-- Alerts -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <t t-if="state.alerts.faulted_stations > 0">
                                <div class="alert alert-danger alert-dismissible fade show">
                                    <i class="fa fa-exclamation-triangle me-2"/> 
                                    <strong>Alert:</strong> 
                                    <span t-esc="state.alerts.faulted_stations"/> faulted charging stations.
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"/>
                                    <a href="#" class="alert-link float-end" t-on-click="() => this.openModel('charging.station', [['status','=','Faulted']])">View</a>
                                </div>
                            </t>
                        </div>
                        <div class="col-md-6">
                            <t t-if="state.alerts.overdue_maintenance > 0">
                                <div class="alert alert-warning alert-dismissible fade show">
                                    <i class="fa fa-tools me-2"/> 
                                    <strong>Maintenance:</strong> 
                                    <span t-esc="state.alerts.overdue_maintenance"/> stations need maintenance.
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"/>
                                    <a href="#" class="alert-link float-end" t-on-click="() => this.openModel('charging.station', [['next_scheduled_maintenance','&lt;',new Date()]])">View</a>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="row mb-2">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.total_stations"/>
                                            </div>
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('charging.station', [])">
                                                Total Charging Stations</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fa fa-plus fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.active_sessions"/>
                                            </div>
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('wallbox.charging.session', [['status','=','Started']])">
                                                Active Sessions</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fa fa-bolt fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.pending_installations"/>
                                            </div>
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('wallbox.installation', [['state','in',['draft','confirmed']]])">
                                                Pending Installations</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fa fa-exclamation-triangle fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.revenue?.toFixed(2)"/>
                                            </div>
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('wallbox.charging.session', [])">
                                                Revenue</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fa fa-money fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-2 align-items-stretch">
                        <div class="col-xl-3 col-lg-6 mb-4">
                            <div class="card shadow h-100">
                                <div class="card-body">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas t-ref="taskStatusChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="col-xl-3 col-md-6 mb-4">
                            <div class="row mb-4">
                                <div class="col-xl-12">
                                    <div class="card border-left-primary shadow h-100">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                        <t t-esc="state.summary.condominium_count"/>
                                                    </div>
                                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('condominium.condominium', [])">
                                                        Condominium</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="fas fa-city fa-2x text-gray-300"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-4">
                                <div class="col-xl-12">
                                    <div class="card border-left-primary shadow h-100">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                        <t t-esc="state.summary.building_count"/>
                                                    </div>
                                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('building.building', [])">
                                                        Building</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="fas fa-building fa-2x text-gray-300"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-xl-12">
                                    <div class="card border-left-primary shadow h-100">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                        <t t-esc="state.summary.parking_space_count"/>
                                                    </div>
                                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('parking.space', [])">
                                                        Parking Space</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="fas fa-parking fa-2x text-gray-300"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-xl-3 col-md-6 mb-4 align-items-stretch">
                                <div class="row mb-4">
                                    <div class="col-xl-12">
                                        <div class="card border-left-primary shadow h-100">
                                            <div class="card-body">
                                                <div class="row mb-1 d-flex justify-content-between">
                                                    <div class="col font-weight-bold text-success gradient-text h5" style="color: #2e7d32;">
                                                        <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.my_amount_total"/>
                                                    </div>
                                                    <div class="col mr-2 text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer d-flex justify-content-end">
                                                        <i class="fas fa-charging-station fa-2x text-warning"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col text-nowrap font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('request.charging', [['request_user_id', '=', state.summary.partner_id]])">My Charging Requests
                                                    </div>
                                                    <div class="col h5 mb-0 font-weight-bold text-gray-800 d-flex justify-content-end d-flex align-items-end">
                                                        <t t-esc="state.summary.total_my_charging_request"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-4">
                                    <div class="col-xl-12">
                                        <div class="card border-left-primary shadow h-100" style="background-color: #f44336; color: white;">
                                            <div class="card-body">
                                                <div class="row mb-1">
                                                    <div class="col font-weight-bold text-white font-weight-bold gradient-text h5 mb-0">
                                                        <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.guest_amount_total"/>
                                                    </div>
                                                    <div class="col d-flex justify-content-end">
                                                        <i class="fas fa-charging-station fa-2x text-white font-weight-bold"/>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col text-nowrap text-white font-weight-bold text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('request.charging', [['request_user_id', '!=', state.summary.partner_id]])">Guest Charging Requests
                                                    </div>
                                                    <div class="col h5 mb-0 text-white font-weight-bold d-flex justify-content-end d-flex align-items-end">
                                                        <t t-esc="state.summary.total_guest_charging_request"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-xl-12">
                                        <div class="card border-left-primary shadow h-100">
                                            <div class="card-body">
                                                <div class="row no-gutters align-items-center">
                                                    <div class="col mr-2">
                                                        <div class="h5 mb-3 font-weight-bold text-gray-800">
                                                            <t t-esc="state.summary.user_count"/>
                                                        </div>
                                                        <div class="text-nowrap font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('res.partner', [])">
                                                            Users</div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <i class="fas fa-users fa-2x text-info"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="col-xl-6 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                    <h6 class="m-0 font-weight-bold text-primary">Revenue</h6>
                                    <!-- optional: Month/Day/Year buttons -->
                                </div>
                                <div class="card-body">
                                    <div style="height:240px;">
                                        <canvas t-ref="revenueChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="row mb-2">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('condominium.condominium', [])">
                                                Condominium</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.condominium_count"/>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-city fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('building.building', [])">
                                                Building</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.building_count"/>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-building fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('parking.space', [])">
                                                Parking Space</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.parking_space_count"/>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-parking fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('res.partner', [])">
                                                Users</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <t t-esc="state.summary.user_count"/>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-users fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="row">
                                                <div class="col-auto text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('request.charging', [['request_user_id', '=', state.summary.partner_id]])">My Charging Requests</div>
                                                <div class="col font-weight-bold text-success d-flex flex-row-reverse gradient-text h5 mb-0" style="color: #2e7d32;">
                                                    <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.my_amount_total"/>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col h5 mb-0 font-weight-bold text-gray-800">
                                                    <t t-esc="state.summary.total_my_charging_request"/>
                                                </div>
                                                <div class="col d-flex flex-row-reverse">
                                                    <i class="fas fa-charging-station fa-2x text-gray-300"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="row">
                                                <div class="col-auto text-xs font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('request.charging', [['request_user_id', '!=', state.summary.partner_id]])">Guest Charging Requests</div>
                                                <div class="col font-weight-bold text-success d-flex flex-row-reverse gradient-text h5 mb-0">
                                                    <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.guest_amount_total"/>
                                                </div>
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col h5 mb-0 font-weight-bold text-gray-800">
                                                    <t t-esc="state.summary.total_guest_charging_request"/>
                                                </div>
                                                <div class="col d-flex flex-row-reverse">
                                                    <i class="fas fa-charging-station fa-2x text-gray-300"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col-auto text-xs-1 font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('sale.order', [['request_charging_id', '!=', false]])">Wallbox Sale Orders</div>
                                        <div class="col font-weight-bold text-success d-flex flex-row-reverse gradient-text h5 mb-0">
                                            <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.total_sale_order"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col h5 mb-0 font-weight-bold text-gray-800">
                                            <t t-esc="state.summary.total_wallbox_sale_order"/>
                                        </div>
                                        <div class="col d-flex flex-row-reverse">
                                            <i class="fas fa-file-signature fa-2x text-gray-300"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col-auto text-xs-1 font-weight-bold text-primary text-uppercase mb-1 cursor-pointer" t-on-click="() => this.openModel('account.move', [['user_id', '=', state.summary.user_id]])">Invoice</div>
                                        <div class="col font-weight-bold text-success d-flex flex-row-reverse gradient-text h5 mb-0">
                                        <t t-esc="state.summary.currency_symbol"/><t t-esc="state.summary.total_invoice_amount"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col h5 mb-0 font-weight-bold text-gray-800">
                                            <t t-esc="state.summary.total_invoice"/>
                                        </div>
                                        <div class="col d-flex flex-row-reverse">
                                            <i class="fas fa-receipt fa-2x text-gray-300" style="text-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <!-- Charts Row -->
                    <div class="row mb-4">
                        <!-- Installation Status -->
                        <div class="col-xl-4 col-lg-6 mb-4">
                            <div class="card shadow h-100">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                    <h6 class="m-0 font-weight-bold text-primary">Installation Status</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas t-ref="installationChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Station Status -->
                        <div class="col-xl-4 col-lg-6 mb-4">
                            <div class="card shadow h-100">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                    <h6 class="m-0 font-weight-bold text-primary">Station Status</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas t-ref="stationChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Energy Consumption -->
                        <div class="col-xl-4 col-lg-12 mb-4">
                            <div class="card shadow h-100">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                                    <h6 class="m-0 font-weight-bold text-primary">Energy Consumption</h6>
                                </div>
                                <div class="card-body">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas t-ref="energyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-white">
                            <h6 class="m-0 font-weight-bold text-primary">Recent Wallbox Orders</h6>
                            <h6 class="m-0 font-weight-bold text-primary">
                                Total Wallbox Orders: <t t-esc="state.summary.total_wallbox_orders"/>
                            </h6>
                            <a href="#" t-on-click="() => this.openModel('wallbox.order', [])" class="btn btn-sm btn-primary">
                                View All
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Order</th>
                                            <th>Customer</th>
                                            <th>Product</th>
                                            <th>Status</th>
                                            <th>Installation Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="state.recentOrders" t-as="order" t-key="order.id">
                                            <tr t-key="order.id" class="clickable-row" t-on-click="() => this.openModel('wallbox.order', [['id','=',order.id]])">
                                                <td><t t-esc="order.name"/></td>
                                                <td><t t-esc="order.customer_id[1]"/></td>
                                                <td><t t-esc="order.product_id[1]"/></td>
                                                <td>
                                                    <span t-att-class="'badge badge-' + {
                                                        'draft': 'primary',
                                                        'confirmed': 'info',
                                                        'scheduled': 'warning',
                                                        'completed': 'success',
                                                        'cancelled': 'danger'
                                                    }[order.state]">
                                                        <t t-esc="order.state"/>
                                                    </span>
                                                </td>
                                                <td><t t-esc="order.installation_date"/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </t>
            </div>
        </div>
    </t>
</templates>
