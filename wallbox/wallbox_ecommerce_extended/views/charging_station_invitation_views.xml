<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_charging_station_invitation_list" model="ir.ui.view">
        <field name="name">charging.station.invitation.list</field>
        <field name="model">charging.station.invitation</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="charging_station_id"/>
                <field name="sender_id"/>
                <field name="receiver_id"/>
                <field name="email"/>
                <field name="request_type"/>
                <field name="status"/>
            </list>
        </field>
    </record>

    <record id="view_charging_station_send_invitation_form" model="ir.ui.view">
        <field name="name">charging.station.send.invitation.form</field>
        <field name="model">charging.station.invitation</field>
        <field name="arch" type="xml">
            <form string="Send Invitation">
                <header>
                    <button string="Send Invitation" type="object" name="action_send_invitation" class="btn-primary" invisible="not (status == 'draft' and is_sender)"/>

                    <button string="Cancel" type="object" name="action_cancel" invisible="status not in ('pending', 'accepted') and status != 'accepted' or not is_sender and not (is_receiver and status == 'accepted')"/>
                    <button string="Reset to Draft" type="object" name="action_reset_to_draft" invisible="not ((status == 'cancelled' or status == 'rejected') and is_sender)"/>
                    <!-- <button string="Cancel" type="object" name="action_cancel" invisible="status not in ('pending', 'accepted') and is_sender"/> -->
                    <button string="Accept Invitation" type="object" name="action_accept_invitation" invisible="not (status == 'pending' and is_receiver)"/>
                    <button string="Reject Invitation" type="object" name="action_reject_invitation" invisible="not (status == 'pending' and is_receiver)"/>

                    <field name="status" widget="statusbar"/>
                </header>

                <sheet>
                    <group>
                        <h1><field name="name" nolabel="1" placeholder="INV/000123"/></h1>
                    </group>
                    <group>
                        <group>
                            <field name="request_type" invisible="1"/>
                            <field name="charging_station_id" options="{'no_open': True, 'no_create': True}"/>
                            <field name="sender_id" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                            <field name="receiver_id" options="{'no_open': True, 'no_create': True}"/>
                        </group>
                        <group>
                            <field name="user_name" string="Name"/>
                            <field name="email"/>
                            <field name="mobile"/>
                            <field name="is_sender" invisible="1"/>
                            <field name="is_receiver" invisible="1"/>
                        </group>
                    </group>
                    <group>
                        <field name="note" nolabel="1" placeholder="Invitation Note ..."/>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_charging_station_request_invitation_form" model="ir.ui.view">
        <field name="name">charging.station.request.invitation.form</field>
        <field name="model">charging.station.invitation</field>
        <field name="arch" type="xml">
            <form string="Request Invitation">
                <header>
                    <button string="Request Invitation" type="object" name="action_invitation_request" class="btn-primary" invisible="not (status == 'draft' and is_sender)"/>
                    <button string="Cancel" type="object" name="action_cancel" invisible="status not in ('pending', 'accepted') and status != 'accepted' or not is_sender and not (is_receiver and status == 'accepted')"/>

                    <!-- <button string="Cancel" type="object" name="action_cancel"/> -->
                    <button string="Reset to Draft" type="object" name="action_reset_to_draft" invisible="not ((status == 'cancelled' or status == 'rejected') and is_sender)"/>
                    <!-- when ststus is in pending visible accept/reject button -->
                    <button string="Accept Request" type="object" name="action_accept_request" invisible="not (status == 'pending' and is_receiver)" class="btn-primary"/>
                    <button string="Reject Request" type="object" name="action_reject_request" invisible="not (status == 'pending' and is_receiver)"/>

                    <field name="status" widget="statusbar"/>
                </header>

                <sheet>
                    <group>
                        <h1><field name="name" nolabel="1" placeholder="INV/000123"/></h1>
                    </group>
                    <group>
                        <group>
                            <field name="charging_station_name"/>
                            <field name="charging_station_id" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                        </group>
                        <group>
                            <field name="request_type" invisible="1"/>
                            <field name="sender_id" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                            <field name="receiver_id" readonly="1" options="{'no_open': True, 'no_create': True}"/>
                            <field name="is_sender" invisible="1"/>
                            <field name="is_receiver" invisible="1"/>
                        </group>
                    </group>
                    <group>
                        <field name="note" nolabel="1" placeholder="Invitation Note ..."/>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- <record id="view_charging_station_invitation_form" model="ir.ui.view">
        <field name="name">charging.station.invitation.form</field>
        <field name="model">charging.station.invitation</field>
        <field name="arch" type="xml">
            <form string="Charging Station Invitation">
                <header>
                    <button string="Send Invitation" type="object" name="action_send_invitation"
                            invisible="not show_send_invitation_button" class="btn-primary"/>
                    <button string="Request Invitation" type="object" name="action_send_request" 
                            invisible="not show_send_request_button" class="btn-primary"/>
                    <button string="Accept" type="object" name="action_accept" 
                            invisible="not show_accept_button" class="btn-primary"/>
                    <button string="Reject" type="object" name="action_reject" 
                            invisible="not show_reject_button"/>
                    <button string="Cancel" type="object" name="action_cancel" invisible="not show_cancel_button"/>

                    <button string="Reset to Draft" type="object" name="action_reset_to_draft" invisible="status != 'cancelled'"/>

                    <field name="status" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="request_type"/>

                            <field name="charging_station_id"
                                   invisible="not show_charging_station_id"
                                   required="show_charging_station_id"/>
                            <field name="charging_station_name" 
                                   invisible="not show_charging_station_name"
                                   required="show_charging_station_name"
                                   placeholder="Enter charging station name..."/>

                            <field name="sender_id" readonly="1"/>
                            <field name="receiver_id" readonly="is_readonly"/>
                        </group>
                        <group>
                            <field name="email" readonly="is_readonly"/>
                            <field name="mobile" readonly="is_readonly"/>
                            <field name="name" readonly="1" string="Invitation ID"/>
                            <field name="user_name" readonly="is_readonly"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Invitation Note">
                            <field name="note" readonly="is_readonly" placeholder="Enter your message..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record> -->

    <record id="action_charging_station_send_invitation" model="ir.actions.act_window">
        <field name="name">Send Invitation</field>
        <field name="res_model">charging.station.invitation</field>
        <field name="view_mode">list,form</field>
        <field name="context">{
            'default_request_type': 'owner_to_user',
            'form_view_ref': "wallbox_ecommerce_extended.view_charging_station_send_invitation_form"
        }</field>
        <field name="domain">[('request_type', '=', 'owner_to_user')]</field>
    </record>

    <menuitem id="menu_invitations_management" name="Manage Invitation" parent="wallbox_integration.menu_charging"/>

    <menuitem id="menu_charging_station_send_invitation" name="Send Invitation" parent="menu_invitations_management" action="action_charging_station_send_invitation"/>

    <record id="action_charging_station_request_invitation" model="ir.actions.act_window">
        <field name="name">Request Invitation</field>
        <field name="res_model">charging.station.invitation</field>
        <field name="view_mode">list,form</field>
        <field name="context">{
            'default_request_type': 'user_to_owner',
            'form_view_ref': "wallbox_ecommerce_extended.view_charging_station_request_invitation_form"
        }</field>
        <field name="domain">[('request_type', '=', 'user_to_owner')]</field>
    </record>

    <menuitem id="menu_charging_station_request_invitation" name="Request Invitation" parent="menu_invitations_management" action="action_charging_station_request_invitation"/>

</odoo>
